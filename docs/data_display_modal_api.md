# æ•°æ®å±•ç¤ºæ¨¡æ€æ¡† API æ–‡æ¡£

## æ¦‚è¿°

æ•°æ®å±•ç¤ºæ¨¡æ€æ¡† API ä¸º DataDisplayModal ç»„ä»¶æä¾›å®Œæ•´çš„åç«¯æ”¯æŒï¼ŒåŒ…æ‹¬æ•°æ®æºé…ç½®ã€ç»Ÿè®¡ä¿¡æ¯è·å–ã€æ•°æ®æ›´æ–°å’Œå¯¼å‡ºç­‰åŠŸèƒ½ã€‚è¯¥APIä½¿ç”¨ `get_auto_analysis_result` ä½œä¸ºä¸»è¦æ•°æ®æºï¼Œç¡®ä¿å±•ç¤ºçš„æ˜¯çœŸå®çš„åˆ†ææ•°æ®ã€‚

## åŸºç¡€ä¿¡æ¯

- **åŸºç¡€ URL**: `http://localhost:8000/api/data-sources`
- **è®¤è¯æ–¹å¼**: æ— éœ€è®¤è¯ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- **å“åº”æ ¼å¼**: JSON

## é€šç”¨å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "Success",
  "data": {}
}
```

## API æ¥å£åˆ—è¡¨

### 1. æ•°æ®æºé…ç½®

#### 1.1 è·å–æ•°æ®æºé…ç½®ä¿¡æ¯

- **URL**: `GET /config`
- **æè¿°**: è·å–æ‰€æœ‰æ•°æ®æºé…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®æºé€‰é¡¹ã€ç ”ç©¶é¢†åŸŸé€‰é¡¹ã€å­ç±»å‹é€‰é¡¹å’Œå¯¼å‡ºæ ¼å¼é€‰é¡¹
- **å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "dataSourceOptions": [
      {"label": "ğŸ“š å­¦æœ¯è®ºæ–‡", "value": "academic_papers"},
      {"label": "ğŸ“Š è°ƒæŸ¥æŠ¥å‘Š", "value": "survey_reports"}
    ],
    "fieldOptions": ["è®¡ç®—æœºç§‘å­¦", "äººå·¥æ™ºèƒ½", "æ•°æ®ç§‘å­¦"],
    "subTypeOptions": {
      "academic_papers": ["æœŸåˆŠè®ºæ–‡", "ä¼šè®®è®ºæ–‡", "å­¦ä½è®ºæ–‡", "é¢„å°æœ¬"]
    },
    "exportOptions": ["CSV", "Excel", "PDF", "JSON"]
  }
}
```

#### 1.2 è·å–å­ç±»å‹é€‰é¡¹

- **URL**: `GET /{data_source}/sub-types`
- **å‚æ•°**:
  - `data_source`: æ•°æ®æºç±»å‹ï¼ˆå¦‚ï¼šacademic_papersï¼‰
- **å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "subTypes": ["æœŸåˆŠè®ºæ–‡", "ä¼šè®®è®ºæ–‡", "å­¦ä½è®ºæ–‡", "é¢„å°æœ¬"]
  }
}
```

### 2. æ•°æ®ç»Ÿè®¡

#### 2.1 è·å–æ•°æ®ç»Ÿè®¡ä¿¡æ¯

- **URL**: `GET /stats`
- **æè¿°**: è·å–å®Œæ•´çš„æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œä½¿ç”¨ `get_auto_analysis_result` ä½œä¸ºæ•°æ®æº
- **æŸ¥è¯¢å‚æ•°**:
  - `dataSource` (å¯é€‰): æ•°æ®æºç±»å‹
  - `dateRange` (å¯é€‰): æ—¥æœŸèŒƒå›´
  - `fields` (å¯é€‰): ç ”ç©¶é¢†åŸŸ
- **å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "metricData": [
      {"title": "æ–‡çŒ®æ€»é‡", "value": "52,489", "trend": "+12.5%"},
      {"title": "å›¾æ–‡æ•°æ®é›†", "value": "15,932", "trend": "+8.3%"}
    ],
    "chartData": {
      "categories": ["å­¦æœ¯è®ºæ–‡", "è°ƒæŸ¥æŠ¥å‘Š", "ä¸“ä¸šä¹¦ç±"],
      "values": [25000, 12000, 8000]
    },
    "latestData": [
      {
        "title": "äººå·¥æ™ºèƒ½å‘å±•ç™½çš®ä¹¦",
        "type": "è°ƒæŸ¥æŠ¥å‘Š",
        "dataSize": 1250,
        "updateDate": "2024-01-15"
      }
    ]
  }
}
```

#### 2.2 è·å–æŒ‡æ ‡å¡æ•°æ®

- **URL**: `GET /metrics`
- **æè¿°**: å•ç‹¬è·å–æŒ‡æ ‡å¡æ•°æ®

#### 2.3 è·å–å›¾è¡¨æ•°æ®

- **URL**: `GET /chart-data`
- **æè¿°**: è·å–æŸ±çŠ¶å›¾æ•°æ®
- **æŸ¥è¯¢å‚æ•°**:
  - `dataSource` (å¯é€‰): æ•°æ®æºç±»å‹
  - `dateRange` (å¯é€‰): æ—¥æœŸèŒƒå›´

#### 2.4 è·å–æœ€æ–°æ•°æ®åˆ—è¡¨

- **URL**: `GET /latest`
- **æè¿°**: è·å–æœ€æ–°æ•°æ®é¡¹åˆ—è¡¨
- **æŸ¥è¯¢å‚æ•°**:
  - `limit` (å¯é€‰): è¿”å›æ•°é‡é™åˆ¶ï¼Œé»˜è®¤5
  - `dataSource` (å¯é€‰): æ•°æ®æºç±»å‹
  - `type` (å¯é€‰): æ•°æ®ç±»å‹

### 3. æ•°æ®æ›´æ–°

#### 3.1 æ›´æ–°æ•°æ®

- **URL**: `POST /update`
- **æè¿°**: æ ¹æ®é€‰æ‹©çš„å‚æ•°é‡æ–°è·å–å’Œåˆ†ææ•°æ®
- **è¯·æ±‚ä½“**:

```json
{
  "dataSource": "academic_papers",
  "selectedSubTypes": ["æœŸåˆŠè®ºæ–‡"],
  "dateRange": ["2023-01-01", "2023-12-31"],
  "selectedFields": ["è®¡ç®—æœºç§‘å­¦", "äººå·¥æ™ºèƒ½"]
}
```

- **å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "message": "æ•°æ®æ›´æ–°è¯·æ±‚å·²æäº¤",
  "data": {
    "success": true,
    "message": "æ•°æ®æ›´æ–°ä¸­ï¼Œè¯·ç¨åæŸ¥çœ‹ç»“æœ",
    "taskId": "update_20240115_120000"
  }
}
```

#### 3.2 è·å–æ›´æ–°è¿›åº¦

- **URL**: `GET /update/progress/{task_id}`
- **å‚æ•°**:
  - `task_id`: æ›´æ–°ä»»åŠ¡ID
- **å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "progress": 75,
    "status": "running",
    "message": "æ­£åœ¨å¤„ç†æ•°æ®..."
  }
}
```

### 4. æ•°æ®å¯¼å‡º

#### 4.1 å¯¼å‡ºæ•°æ®

- **URL**: `POST /export`
- **æè¿°**: æ ¹æ®æŒ‡å®šæ ¼å¼å’Œå‚æ•°å¯¼å‡ºæ•°æ®
- **è¯·æ±‚ä½“**:

```json
{
  "format": "CSV",
  "dataSource": "academic_papers",
  "dateRange": ["2023-01-01", "2023-12-31"],
  "fields": ["title", "type", "dataSize"]
}
```

#### 4.2 è·å–å¯¼å‡ºçŠ¶æ€

- **URL**: `GET /export/status/{task_id}`
- **å‚æ•°**:
  - `task_id`: å¯¼å‡ºä»»åŠ¡ID
- **å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "status": "completed",
    "progress": 100,
    "downloadUrl": "/api/downloads/export_20240115_120000.csv"
  }
}
```

### 5. å®æ—¶æ•°æ®

#### 5.1 è·å–å®æ—¶æ›´æ–°

- **URL**: `GET /realtime`
- **æè¿°**: è·å–å®æ—¶æ•°æ®æ›´æ–°ä¿¡æ¯
- **å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "lastUpdate": "2024-01-15T12:00:00Z",
    "hasNewData": false,
    "newDataCount": 0,
    "metrics": [
      {"title": "æ–‡çŒ®æ€»é‡", "value": "52,489", "trend": "+12.5%"}
    ]
  }
}
```

## æ•°æ®é›†æˆè¯´æ˜

### è‡ªåŠ¨åˆ†æç»“æœé›†æˆ

è¯¥APIå·²ç»é›†æˆäº† `get_auto_analysis_result` å‡½æ•°ï¼Œå®ç°äº†çœŸå®æ•°æ®çš„åŠ¨æ€è·å–ï¼š

#### é›†æˆæ–¹å¼

1. **æ•°æ®ç»Ÿè®¡æ¥å£** (`/stats`) ä¼˜å…ˆä½¿ç”¨è‡ªåŠ¨åˆ†æç»“æœ
2. **æ™ºèƒ½æ˜ å°„** å°†èµ„æºåç§°è‡ªåŠ¨æ˜ å°„åˆ°åˆé€‚çš„æ•°æ®ç±»å‹
3. **é™çº§å¤„ç†** å½“è‡ªåŠ¨åˆ†ææ•°æ®ä¸å¯ç”¨æ—¶ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®

#### æ•°æ®æµç¨‹

```
get_auto_analysis_result()
    â†“
ResourceItem[] (èµ„æºåˆ—è¡¨)
    â†“
map_resource_to_data_type() (ç±»å‹æ˜ å°„)
    â†“
ç»Ÿè®¡æ•°æ®ç”Ÿæˆ
    â†“
å‰ç«¯ DataDisplayModal ç»„ä»¶
```

#### æ˜ å°„é€»è¾‘

èµ„æºåç§°åˆ°æ•°æ®ç±»å‹çš„æ˜ å°„è§„åˆ™ï¼š
- åŒ…å«"è®ºæ–‡"ã€"å­¦æœ¯"ã€"ç ”ç©¶" â†’ "å­¦æœ¯è®ºæ–‡"
- åŒ…å«"æŠ¥å‘Š"ã€"è°ƒç ”"ã€"åˆ†æ" â†’ "è°ƒæŸ¥æŠ¥å‘Š"
- åŒ…å«"ä¹¦ç±"ã€"æ•™æ"ã€"ä¸“è‘—" â†’ "ä¸“ä¸šä¹¦ç±"
- åŒ…å«"æ”¿ç­–"ã€"è§„å®š"ã€"åˆ¶åº¦" â†’ "æ”¿ç­–æ–‡ä»¶"
- åŒ…å«"æ³•è§„"ã€"æ ‡å‡†"ã€"è§„èŒƒ" â†’ "æ³•è§„æ ‡å‡†"
- å…¶ä»–æƒ…å†µé»˜è®¤ä¸º â†’ "å­¦æœ¯è®ºæ–‡"

## é”™è¯¯å¤„ç†

æ‰€æœ‰æ¥å£éƒ½åŒ…å«ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

- **500 Internal Server Error**: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- **404 Not Found**: èµ„æºä¸å­˜åœ¨
- **400 Bad Request**: è¯·æ±‚å‚æ•°é”™è¯¯

é”™è¯¯å“åº”æ ¼å¼ï¼š
```json
{
  "detail": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

## ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```typescript
import { dataDisplayModalApi } from '@/api/dataDisplayModal'

// è·å–æ•°æ®ç»Ÿè®¡
const stats = await dataDisplayModalApi.getDataStats({
  dataSource: 'academic_papers',
  dateRange: ['2023-01-01', '2023-12-31']
})

// æ›´æ–°æ•°æ®
const updateResult = await dataDisplayModalApi.updateData({
  dataSource: 'academic_papers',
  selectedSubTypes: ['æœŸåˆŠè®ºæ–‡'],
  dateRange: ['2023-01-01', '2023-12-31'],
  selectedFields: ['è®¡ç®—æœºç§‘å­¦']
})
```
